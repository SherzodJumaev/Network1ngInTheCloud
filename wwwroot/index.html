<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClothingCRM</title>
    <link rel="stylesheet" href="./web.css">
    <link rel="stylesheet" href="./chart.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">ClothingCRM</div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                        </svg>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="products">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                        </svg>
                        Products
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="customers">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                        Customers
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="orders">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z" />
                        </svg>
                        Orders
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="sales-report">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <path
                                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                        </svg>
                        Sales Report
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <div class="search-container">
                    <svg class="search-icon" viewBox="0 0 24 24">
                        <path
                            d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                    </svg>
                    <input type="text" class="search-input" placeholder="Search here...">
                </div>
                <div class="user-profile">
                    <div class="user-avatar">SJ</div>
                    <div class="user-name">Sherzod Jumayev Default</div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard" class="content-page active">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">Today's Sales</div>
                        <div class="stat-value">$<span id="todays-sales">0</span></div>
                        <div class="stat-change" id="sales-change">
                            +10% from yesterday
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Orders</div>
                        <div class="stat-value" id="total-orders">0</div>
                        <div class="stat-change" id="orders-change">
                            +8% from yesterday
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Items Sold</div>
                        <div class="stat-value" id="items-sold">0</div>
                        <div class="stat-change" id="items-change">
                            +2% from yesterday
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">New Customers</div>
                        <div class="stat-value" id="new-customers">0</div>
                        <div class="stat-change" id="customers-change">
                            +3% from yesterday
                        </div>
                    </div>
                </div>

                <div class="top-products">
                    <div class="table-header">
                        <h3 class="table-title">Top Products</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Sales</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody id="top-products-tbody">
                            <tr>
                                <td colspan="5" class="loading">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products Page -->
            <div id="products" class="content-page">
                <div class="page-title">Products</div>
                <!-- <div class="form-container">
                    <form id="product-form">
                        <div class="form-group">
                            <label class="form-label">Product Name</label>
                            <input type="text" class="form-input" id="product-name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-input" id="product-category" required>
                                <option value="">Select Category</option>
                                <option value="Formal Wear">Formal Wear</option>
                                <option value="Casual Wear">Casual Wear</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price</label>
                            <input type="number" step="0.01" class="form-input" id="product-price" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Stock Quantity</label>
                            <input type="number" class="form-input" id="product-stock" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Add Product</button>
                            <button type="button" class="btn btn-secondary" id="cancel-product">Cancel</button>
                        </div>
                    </form>
                </div> -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">All Products</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Sales Count</th>
                                <th>Revenue</th>
                                <th>Created At</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody">
                            <tr>
                                <td colspan="8" class="loading">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Customers Page -->
            <div id="customers" class="content-page">
                <div class="page-title">Customers</div>
                <!-- <div class="form-container">
                    <form id="customer-form">
                        <div class="form-group">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-input" id="customer-firstname" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-input" id="customer-lastname" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="customer-email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-input" id="customer-phone" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Add Customer</button>
                            <button type="button" class="btn btn-secondary" id="cancel-customer">Cancel</button>
                        </div>
                    </form>
                </div> -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">All Customers</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Created</th>
                                <th>Orders</th>
                                <!-- <th>Actions</th> -->
                            </tr>
                        </thead>
                        <tbody id="customers-tbody">
                            <tr>
                                <td colspan="7" class="loading">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Orders Page -->
            <div id="orders" class="content-page">
                <div class="page-title">Orders</div>
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">All Orders</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Order Status</th>
                                <th>Total</th>
                                <!-- <th>Items</th> -->
                                <!-- <th>Actions</th> -->
                            </tr>
                        </thead>
                        <tbody id="orders-tbody">
                            <tr>
                                <td colspan="7" class="loading">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales Report Page -->
            <!-- <div id="sales-report" class="content-page">
                <div class="page-title">Sales Report</div>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">$<span id="total-revenue">0</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Order Value</div>
                        <div class="stat-value">$<span id="avg-order-value">0</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Products Sold</div>
                        <div class="stat-value" id="total-products-sold">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Customers</div>
                        <div class="stat-value" id="active-customers">0</div>
                    </div>
                </div>
            </div> -->

            <div id="sales-report" class="content-page">
                <div class="page-title">Sales Report</div>

                <!-- Original Stats Cards -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">$<span id="total-revenue">0</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Order Value</div>
                        <div class="stat-value">$<span id="avg-order-value">0</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Products Sold</div>
                        <div class="stat-value" id="total-products-sold">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Customers</div>
                        <div class="stat-value" id="active-customers">0</div>
                    </div>
                </div>

                <!-- Chart Controls -->
                <div class="chart-controls">
                    <h3 style="margin: 0; color: #333;">Analytics Dashboard</h3>
                    <div style="display: flex; gap: 20px; align-items: center;">
                        <div class="time-period-selector">
                            <button class="period-btn active" data-period="overall">Overall</button>
                            <button class="period-btn" data-period="yearly">By Year</button>
                            <button class="period-btn" data-period="monthly">By Month</button>
                        </div>
                        <div class="month-selector-container" id="month-selector-container" style="display: none;">
                            <span class="month-selector-label">Select Month:</span>
                            <select class="month-selector" id="month-selector">
                                <option value="all">All Months</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="chart-summary" id="chart-summary"></div>

                <!-- Charts Grid -->
                <div class="chart-grid" id="charts-container"></div>
            </div>

            <script>
                // Configuration Constants
                const CONFIG = {
                    CHART_TYPES: {
                        REVENUE: 'revenue',
                        PRODUCT: 'product',
                        CUSTOMER: 'customer'
                    },
                    PERIODS: {
                        OVERALL: 'overall',
                        YEARLY: 'yearly',
                        MONTHLY: 'monthly',
                        SPECIFIC_MONTH: 'specific_month'
                    },
                    CHART_COLORS: {
                        PRIMARY: '#007bff',
                        SUCCESS: '#28a745',
                        INFO: '#17a2b8',
                        WARNING: '#ffc107',
                        DANGER: '#dc3545',
                        SECONDARY: '#6c757d'
                    },
                    PRODUCT_COLORS: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF']
                };

                // Data Service Class
                class DataService {
                    static generateMockData() {
                        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                        const monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        const categories = ['T-Shirts', 'Jeans', 'Dresses', 'Accessories', 'Shoes'];

                        // Generate detailed monthly data for the full year
                        const monthlyRevenue = [890, 1240, 2145, 1650, 980, 1422, 1890, 2100, 1780, 1560, 1340, 1920];
                        const monthlyProductsSold = [
                            [3, 5, 2, 1, 2], // Jan
                            [4, 6, 3, 2, 3], // Feb
                            [8, 7, 4, 3, 3], // Mar
                            [5, 6, 3, 2, 2], // Apr
                            [2, 4, 2, 1, 1], // May
                            [6, 7, 3, 2, 2], // Jun
                            [7, 8, 4, 3, 3], // Jul
                            [8, 9, 5, 3, 4], // Aug
                            [6, 7, 4, 2, 3], // Sep
                            [5, 6, 3, 2, 2], // Oct
                            [4, 5, 2, 1, 2], // Nov
                            [7, 8, 4, 3, 3]  // Dec
                        ];
                        const monthlyCustomers = {
                            new: [2, 3, 4, 2, 1, 3, 4, 5, 3, 2, 2, 4],
                            returning: [3, 4, 6, 5, 4, 5, 6, 7, 5, 4, 3, 6]
                        };

                        return {
                            revenue: {
                                monthly: monthlyRevenue.slice(0, 6), // First 6 months for initial display
                                yearly: [5200, 6327, 7890],
                                fullYear: monthlyRevenue, // Full year data
                                labels: {
                                    monthly: monthsShort.slice(0, 6),
                                    yearly: ['2023', '2024', '2025'],
                                    fullYear: monthsShort,
                                    monthNames: months
                                }
                            },
                            products: {
                                categories: [15, 20, 12, 8, 8], // Overall totals
                                monthlyBreakdown: monthlyProductsSold,
                                labels: categories
                            },
                            customers: {
                                new: monthlyCustomers.new.slice(0, 6),
                                returning: monthlyCustomers.returning.slice(0, 6),
                                fullYear: monthlyCustomers,
                                labels: monthsShort.slice(0, 6)
                            }
                        };
                    }

                    static async fetchSalesReport() {
                        // Simulate API call
                        return new Promise((resolve) => {
                            setTimeout(() => {
                                resolve({
                                    totalRevenue: 6327.53,
                                    averageOrderValue: 301.31,
                                    totalProductsSold: 63,
                                    activeCustomers: 8
                                });
                            }, 1000);
                        });
                    }

                    static calculateSalesReport(orders = []) {
                        // Fallback calculation method
                        return {
                            totalRevenue: 6327.53,
                            avgOrderValue: 301.31,
                            totalProductsSold: 63,
                            activeCustomers: 8
                        };
                    }
                }

                // Chart Factory Class
                class ChartFactory {
                    static createRevenueChart(ctx, data, period) {
                        const labels = period === CONFIG.PERIODS.YEARLY ?
                            data.revenue.labels.yearly : data.revenue.labels.monthly;
                        const chartData = period === CONFIG.PERIODS.YEARLY ?
                            data.revenue.yearly : data.revenue.monthly;

                        return new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Revenue ($)',
                                    data: chartData,
                                    borderColor: CONFIG.CHART_COLORS.PRIMARY,
                                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.4,
                                    pointBackgroundColor: CONFIG.CHART_COLORS.PRIMARY,
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                    pointRadius: 6
                                }]
                            },
                            options: this.getLineChartOptions()
                        });
                    }

                    static createProductChart(ctx, data) {
                        return new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: data.products.labels,
                                datasets: [{
                                    data: data.products.categories,
                                    backgroundColor: CONFIG.PRODUCT_COLORS,
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: this.getDoughnutChartOptions()
                        });
                    }

                    static createCustomerChart(ctx, data) {
                        return new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: data.customers.labels,
                                datasets: [
                                    {
                                        label: 'New Customers',
                                        data: data.customers.new,
                                        backgroundColor: CONFIG.CHART_COLORS.SUCCESS,
                                        borderRadius: 4
                                    },
                                    {
                                        label: 'Returning Customers',
                                        data: data.customers.returning,
                                        backgroundColor: CONFIG.CHART_COLORS.INFO,
                                        borderRadius: 4
                                    }
                                ]
                            },
                            options: this.getBarChartOptions()
                        });
                    }

                    static getLineChartOptions() {
                        return {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function (value) {
                                            return '$' + value;
                                        }
                                    }
                                }
                            }
                        };
                    }

                    static getDoughnutChartOptions() {
                        return {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 20,
                                        usePointStyle: true
                                    }
                                }
                            }
                        };
                    }

                    static getBarChartOptions() {
                        return {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'top' }
                            },
                            scales: {
                                x: { stacked: false },
                                y: { beginAtZero: true, stacked: false }
                            }
                        };
                    }
                }

                // UI Component Class
                class UIComponent {
                    static createChartContainer(title, id, fullWidth = false) {
                        return `
                    <div class="chart-container ${fullWidth ? 'full-width-chart' : ''}">
                        <div class="chart-title">${title}</div>
                        <div class="chart-wrapper">
                            <canvas id="${id}"></canvas>
                        </div>
                    </div>
                `;
                    }

                    static createSummaryCard(title, value, subtitle) {
                        return `
                    <div class="summary-card">
                        <h4>${title}</h4>
                        <div class="value">${value}</div>
                        <div class="change">${subtitle}</div>
                    </div>
                `;
                    }

                    static createLoadingSpinner() {
                        return `
                    <div class="loading-state">
                        <div class="spinner"></div>
                    </div>
                `;
                    }

                    static createErrorMessage(message) {
                        return `
                    <div class="error-state">
                        <strong>Error:</strong> ${message}
                    </div>
                `;
                    }
                }

                // Chart Manager Class
                class ChartManager {
                    constructor(data) {
                        this.data = data;
                        this.charts = {};
                        this.currentPeriod = CONFIG.PERIODS.OVERALL;
                        this.selectedMonth = 'all';
                    }

                    initializeCharts() {
                        this.createChartContainers();
                        this.createAllCharts();
                        this.initializeMonthSelector();
                    }

                    initializeMonthSelector() {
                        const monthSelector = document.getElementById('month-selector');
                        const monthNames = this.data.revenue.labels.monthNames;

                        // Clear existing options except "All Months"
                        monthSelector.innerHTML = '<option value="all">All Months</option>';

                        // Add month options
                        monthNames.forEach((month, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = month;
                            monthSelector.appendChild(option);
                        });
                    }

                    createChartContainers() {
                        const container = document.getElementById('charts-container');
                        container.innerHTML = `
                    ${UIComponent.createChartContainer('Revenue Trend', 'revenueChart', true)}
                    ${UIComponent.createChartContainer('Product Categories', 'productChart')}
                    ${UIComponent.createChartContainer('Customer Metrics', 'customerChart')}
                `;
                    }

                    createAllCharts() {
                        this.charts.revenue = ChartFactory.createRevenueChart(
                            document.getElementById('revenueChart').getContext('2d'),
                            this.data,
                            this.currentPeriod
                        );

                        this.charts.product = ChartFactory.createProductChart(
                            document.getElementById('productChart').getContext('2d'),
                            this.data
                        );

                        this.charts.customer = ChartFactory.createCustomerChart(
                            document.getElementById('customerChart').getContext('2d'),
                            this.data
                        );
                    }

                    updateCharts(period, selectedMonth = 'all') {
                        this.currentPeriod = period;
                        this.selectedMonth = selectedMonth;

                        // Show/hide month selector based on period
                        const monthSelectorContainer = document.getElementById('month-selector-container');
                        monthSelectorContainer.style.display = period === CONFIG.PERIODS.MONTHLY ? 'flex' : 'none';

                        // Update revenue chart
                        this.updateRevenueChart(period, selectedMonth);

                        // Update product chart for specific month
                        if (period === CONFIG.PERIODS.MONTHLY && selectedMonth !== 'all') {
                            this.updateProductChartForMonth(selectedMonth);
                        } else {
                            this.updateProductChart();
                        }

                        // Update customer chart
                        this.updateCustomerChart(period, selectedMonth);
                    }

                    updateRevenueChart(period, selectedMonth) {
                        let labels, chartData;

                        if (period === CONFIG.PERIODS.YEARLY) {
                            labels = this.data.revenue.labels.yearly;
                            chartData = this.data.revenue.yearly;
                        } else if (period === CONFIG.PERIODS.MONTHLY) {
                            if (selectedMonth !== 'all') {
                                // Show single month data (could be daily breakdown)
                                labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                                const monthRevenue = this.data.revenue.fullYear[selectedMonth];
                                chartData = [monthRevenue * 0.2, monthRevenue * 0.3, monthRevenue * 0.25, monthRevenue * 0.25];
                            } else {
                                labels = this.data.revenue.labels.fullYear;
                                chartData = this.data.revenue.fullYear;
                            }
                        } else {
                            labels = this.data.revenue.labels.monthly;
                            chartData = this.data.revenue.monthly;
                        }

                        this.charts.revenue.data.labels = labels;
                        this.charts.revenue.data.datasets[0].data = chartData;
                        this.charts.revenue.update();
                    }

                    updateProductChartForMonth(monthIndex) {
                        const monthData = this.data.products.monthlyBreakdown[monthIndex];
                        this.charts.product.data.datasets[0].data = monthData;
                        this.charts.product.update();
                    }

                    updateProductChart() {
                        // Reset to overall data
                        this.charts.product.data.datasets[0].data = this.data.products.categories;
                        this.charts.product.update();
                    }

                    updateCustomerChart(period, selectedMonth) {
                        let labels, newCustomers, returningCustomers;

                        if (period === CONFIG.PERIODS.MONTHLY) {
                            if (selectedMonth !== 'all') {
                                // Show single month data (could be weekly breakdown)
                                labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                                const monthNew = this.data.customers.fullYear.new[selectedMonth];
                                const monthReturning = this.data.customers.fullYear.returning[selectedMonth];
                                newCustomers = [Math.ceil(monthNew * 0.2), Math.ceil(monthNew * 0.3), Math.ceil(monthNew * 0.25), Math.ceil(monthNew * 0.25)];
                                returningCustomers = [Math.ceil(monthReturning * 0.2), Math.ceil(monthReturning * 0.3), Math.ceil(monthReturning * 0.25), Math.ceil(monthReturning * 0.25)];
                            } else {
                                labels = this.data.revenue.labels.fullYear;
                                newCustomers = this.data.customers.fullYear.new;
                                returningCustomers = this.data.customers.fullYear.returning;
                            }
                        } else {
                            labels = this.data.customers.labels;
                            newCustomers = this.data.customers.new;
                            returningCustomers = this.data.customers.returning;
                        }

                        this.charts.customer.data.labels = labels;
                        this.charts.customer.data.datasets[0].data = newCustomers;
                        this.charts.customer.data.datasets[1].data = returningCustomers;
                        this.charts.customer.update();
                    }

                    destroy() {
                        Object.values(this.charts).forEach(chart => chart.destroy());
                        this.charts = {};
                    }
                }

                // Summary Manager Class
                class SummaryManager {
                    constructor() {
                        this.summaryData = {
                            [CONFIG.PERIODS.OVERALL]: {
                                growth: '+15.2%',
                                bestPeriod: 'March',
                                average: '$1,054'
                            },
                            [CONFIG.PERIODS.YEARLY]: {
                                growth: '+21.7%',
                                bestPeriod: '2024',
                                average: '$6,472'
                            },
                            [CONFIG.PERIODS.MONTHLY]: {
                                growth: '+8.3%',
                                bestPeriod: 'March',
                                average: '$1,554'
                            }
                        };
                    }

                    render(period = CONFIG.PERIODS.OVERALL, selectedMonth = 'all') {
                        const container = document.getElementById('chart-summary');
                        let data = this.summaryData[period];

                        // Customize data for specific month selection
                        if (period === CONFIG.PERIODS.MONTHLY && selectedMonth !== 'all') {
                            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                            data = {
                                growth: '+12.5%',
                                bestPeriod: `Week 2`,
                                average: `${Math.floor(Math.random() * 500 + 800)}`
                            };
                        }

                        container.innerHTML = `
                    ${UIComponent.createSummaryCard('Revenue Growth', data.growth, 'vs last period')}
                    ${UIComponent.createSummaryCard('Best Period', data.bestPeriod, 'highest revenue')}
                    ${UIComponent.createSummaryCard('Average Revenue', data.average, 'per period')}
                `;
                    }

                    update(period, selectedMonth = 'all') {
                        this.render(period, selectedMonth);
                    }
                }

                // Main Sales Report Class
                class EnhancedSalesReport {
                    constructor() {
                        this.data = DataService.generateMockData();
                        this.chartManager = null;
                        this.summaryManager = new SummaryManager();
                        this.currentPeriod = CONFIG.PERIODS.OVERALL;

                        this.init();
                    }

                    async init() {
                        try {
                            this.showLoading();
                            await this.updateSalesReport();
                            this.initializeComponents();
                            this.bindEvents();
                            this.hideLoading();
                        } catch (error) {
                            this.handleError(error);
                        }
                    }

                    initializeComponents() {
                        this.chartManager = new ChartManager(this.data);
                        this.chartManager.initializeCharts();
                        this.summaryManager.render();
                    }

                    bindEvents() {
                        document.querySelectorAll('.period-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                this.handlePeriodChange(e.target);
                            });
                        });

                        // Add month selector event listener
                        document.getElementById('month-selector').addEventListener('change', (e) => {
                            this.handleMonthChange(e.target.value);
                        });
                    }

                    handlePeriodChange(target) {
                        // Update UI
                        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                        target.classList.add('active');

                        // Update period and components
                        this.currentPeriod = target.dataset.period;
                        const selectedMonth = document.getElementById('month-selector').value;
                        this.chartManager.updateCharts(this.currentPeriod, selectedMonth);
                        this.summaryManager.update(this.currentPeriod, selectedMonth);
                    }

                    handleMonthChange(selectedMonth) {
                        // Update charts and summary for the selected month
                        this.chartManager.updateCharts(this.currentPeriod, selectedMonth);
                        this.summaryManager.update(this.currentPeriod, selectedMonth);
                    }

                    async updateSalesReport() {
                        try {
                            const salesData = await DataService.fetchSalesReport();
                            this.updateStatsDisplay(salesData);
                        } catch (error) {
                            console.warn('API fetch failed, using fallback calculation:', error);
                            const salesData = DataService.calculateSalesReport();
                            this.updateStatsDisplay(salesData);
                        }
                    }

                    updateStatsDisplay(salesData) {
                        const elements = {
                            'total-revenue': salesData.totalRevenue || salesData.totalRevenue?.toFixed(2) || '0.00',
                            'avg-order-value': salesData.averageOrderValue || salesData.avgOrderValue?.toFixed(2) || '0.00',
                            'total-products-sold': salesData.totalProductsSold || 0,
                            'active-customers': salesData.activeCustomers || 0
                        };

                        Object.entries(elements).forEach(([id, value]) => {
                            const element = document.getElementById(id);
                            if (element) {
                                element.textContent = value;
                            }
                        });
                    }

                    showLoading() {
                        const container = document.getElementById('charts-container');
                        container.innerHTML = UIComponent.createLoadingSpinner();
                    }

                    hideLoading() {
                        // Loading is hidden when charts are rendered
                    }

                    handleError(error) {
                        console.error('Sales Report Error:', error);
                        const container = document.getElementById('charts-container');
                        container.innerHTML = UIComponent.createErrorMessage('Failed to load sales data. Please try again.');
                    }

                    destroy() {
                        if (this.chartManager) {
                            this.chartManager.destroy();
                        }
                    }
                }

                // Initialize the application
                document.addEventListener('DOMContentLoaded', () => {
                    window.salesReport = new EnhancedSalesReport();
                });
            </script>
            
        </main>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Edit Item</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="edit-form">
                <div id="edit-form-fields"></div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    <script src="./web.js"></script>
</body>

</html>